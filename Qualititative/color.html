<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Vibrant.js example</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="libraries/vibrant.js"></script>
  <style>
    /* Style for the swatches & image */
    .swatch {
      border: 5px solid black;
      height: 100px;
      width: 100px;
      float: left;
    }
    img {
      max-width: 100px;
    }
    </style>
  </head>
  <body>
    <div id="image_container">
      <!-- Add your image elements here dynamically -->
    </div>
    
    <script>
      const colors = [];

d3.csv('data.csv').then(function(data) {
  data.slice(0, 1000).forEach(function(d, index) {
    const imgContainer = d3.select('#image_container')
      .append('div')
      .attr('class', 'img-container')
      .attr('id', 'img-container-' + index);

    imgContainer.append('img')
      .attr('src', d.iiifthumburl)
      .attr('class', 'img');

    Vibrant.from(d.iiifthumburl).getPalette(function (err, palette) {
      if (!err) { // Check if there's no error in fetching the palette
        for (var swatch in palette) {
          const hexColor = palette[swatch].getHex();
          colors.push(hexColor);

          const div = document.createElement("div");
          div.className = 'swatch';
          div.style.backgroundColor = hexColor;
          var element = document.querySelector('#img-container-' + index);
          element.appendChild(div);
        }
      }
    });
  });

  // Convert the Set to an array and log all the unique colors
  console.log(colors);
});
    </script>
  </body>
</html>